stateDiagram-v2
    [*] --> Idle
    
    Idle --> ReceiveRequest: User initiates audit
    
    state "ðŸ§  Supervisor Agent" as Supervisor {
        ReceiveRequest --> ParseRequest: Parse supplier name
        ParseRequest --> DelegateInvestigation: Delegate to Investigator
        
        state "Waiting for Intelligence" as WaitIntel
        DelegateInvestigation --> WaitIntel
        
        WaitIntel --> ProcessFindings: Receives findings
        ProcessFindings --> DelegateAudit: Delegate to Auditor
        
        state "Waiting for Compliance" as WaitCompliance
        DelegateAudit --> WaitCompliance
        
        WaitCompliance --> AggregateResults: Receives compliance report
        AggregateResults --> GenerateReport: Format final JSON
        GenerateReport --> ReturnToUser: Send to UI
    }
    
    state "ðŸ•µï¸ Investigator Agent" as Investigator {
        state "Search Phase" as SearchPhase {
            [*] --> InitiateSearch
            InitiateSearch --> QueryNews: Search news sources
            InitiateSearch --> QueryNGO: Search NGO reports
            InitiateSearch --> QueryPublic: Search public records
            
            QueryNews --> CollectResults
            QueryNGO --> CollectResults
            QueryPublic --> CollectResults
        }
        
        CollectResults --> FilterRelevant: Apply relevance filters
        FilterRelevant --> StructureData: Convert to JSON schema
        StructureData --> ValidateFindings: Validate data quality
        ValidateFindings --> [*]: Return findings
    }
    
    state "âš–ï¸ Auditor Agent" as Auditor {
        state "Evaluation Phase" as EvalPhase {
            [*] --> ReceiveFindings
            ReceiveFindings --> PrepareQueries: Prepare RAG queries
            
            state "Policy Check Loop" as PolicyLoop {
                PrepareQueries --> QueryKnowledgeBase
                QueryKnowledgeBase --> InterpretPolicy: Analyze policy context
                InterpretPolicy --> AssessSeverity: Categorize violation
                AssessSeverity --> NextFinding: More findings?
                NextFinding --> QueryKnowledgeBase: Yes
            }
            
            NextFinding --> CompileViolations: No
        }
        
        CompileViolations --> CalculateRiskScore: Aggregate scores
        CalculateRiskScore --> GenerateCompliance: Create report
        GenerateCompliance --> [*]: Return compliance
    }
    
    DelegateInvestigation --> Investigator: Task: Gather Intelligence
    Investigator --> ProcessFindings: Findings JSON
    
    DelegateAudit --> Auditor: Task: Evaluate Compliance
    Auditor --> AggregateResults: Compliance Report
    
    ReturnToUser --> [*]
    
    note right of Supervisor
        Orchestrates workflow
        Manages state
        Formats outputs
    end note
    
    note right of Investigator
        Gathers external data
        No policy knowledge
        Returns facts only
    end note
    
    note right of Auditor
        Policy expert
        RAG-powered
        Risk scoring
    end note
